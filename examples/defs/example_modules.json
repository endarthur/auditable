{
  "format": "auditable-notebook",
  "v": 1,
  "title": "module playground",
  "cells": [
    {
      "type": "code",
      "collapsed": true,
      "code": "// %collapsed\nworkshop([\n  {\n    title: 'Module playground',\n    content: md`This is a guided **workshop** for this notebook.\nUse the **prev** and **next** buttons below to navigate\nbetween pages, or click the progress dots to jump directly.\n\nClose this panel with the **\\u00d7** button. Reopen it\nanytime with the **workshop** tab on the right edge\nof the screen.`\n  },\n  {\n    title: 'install() vs load()',\n    content: md`\\`install(url)\\` fetches a module and\n**embeds its source** in the HTML file on save.\nAfter saving, the module loads instantly with no\nnetwork access. Use it for dependencies you need\noffline.\n\n\\`load(url)\\` imports a module at runtime from the\nnetwork. It\\u2019s cached for the session but not\npersisted. Use it for modules you\\u2019re experimenting\nwith or that are too large to embed.`\n  },\n  {\n    title: 'Offline capability',\n    content: md`When you save a notebook with\n\\`install()\\`-ed modules, the module source is stored\nin the \\`AUDITABLE-MODULES\\` HTML comment block\n(base64-encoded). The notebook becomes fully\nself-contained.\n\nOpen a saved notebook on an airplane \\u2014 installed\nmodules work. \\`load()\\`-ed modules will fail because\nthey need the network. This is the core trade-off:\nembed size vs offline access.`\n  },\n  {\n    title: 'Save persistence',\n    content: md`Both \\`install()\\` and \\`load()\\` share the\nsame import cache (\\`window._importCache\\`). But only\n\\`install()\\` writes to \\`window._installedModules\\`,\nwhich gets serialized into the HTML on save.\n\nThe esm.sh URL gets \\`?bundle\\` appended automatically\nso the module and its dependencies are bundled into\na single fetch. This keeps the installed module\nself-contained.`\n  },\n])"
    },
    {
      "type": "md",
      "code": "# module playground\n\ndemonstrates `install()` for offline-capable module embedding and `load()` for on-demand imports. after saving, installed modules work without a network connection."
    },
    {
      "type": "code",
      "code": "// install() fetches the module source and embeds it in the HTML on save.\n// this means the notebook works offline after saving.\nconst { format, formatDistanceToNow } = await install(\"https://esm.sh/date-fns\");"
    },
    {
      "type": "code",
      "code": "// load() imports a module at runtime (requires network).\n// useful for modules you don't need offline.\nconst confetti = await load(\"https://esm.sh/canvas-confetti\");"
    },
    {
      "type": "code",
      "code": "const dateStyle = ui.dropdown(\"format\", [\"full\", \"short\", \"relative\"]);\nconst sampleDate = ui.textInput(\"date\", \"2024-07-20\");"
    },
    {
      "type": "code",
      "code": "const d = new Date(sampleDate);\nlet formatted;\nif (isNaN(d.getTime())) {\n  formatted = \"(invalid date)\";\n} else if (dateStyle === \"full\") {\n  formatted = format(d, \"EEEE, MMMM do, yyyy\");\n} else if (dateStyle === \"short\") {\n  formatted = format(d, \"MM/dd/yy\");\n} else {\n  formatted = formatDistanceToNow(d, { addSuffix: true });\n}\nui.display(formatted);"
    },
    {
      "type": "code",
      "code": "// confetti on demand\nconst fire = ui.checkbox(\"confetti\", false);\nif (fire) confetti.default({ particleCount: 120, spread: 80, origin: { y: 0.7 } });"
    }
  ],
  "settings": {
    "theme": "dark",
    "fontSize": 13,
    "width": "860"
  }
}
